# Voronoi 图

## 分步解释

1. 空间划分
  - 目标：将整个向量空间（比如所有可能的向量分布区域）划分为多个小块（Voronoi 单元）
  - 规则：每个Voronoi单元对应一个数据库向量（称为「中心点」），单元内的所有点（包括查询点）到该中心点的距离，都比到其他中心点更近
2. 查询过程
  - 当输入一个查询向量时，首先确定它属于哪个Voronoi单元（即找到最近的数据库向量）
  - 只需在该单元及其邻近的几个单元中搜索最近邻，而不需要遍历所有数据库向量
3. 为什么能减少搜索范围？
  - 数学保证：由于Voronoi单元的定义，查询点的最近邻一定在它所在的单元或邻近单元中（除非数据分布非常特殊）
  - 效率提升：假设数据库有100万个向量，但每个Voronoi单元只包含1000个向量，搜索范围就从100万降低到约1000~几千（邻近单元总和）

## 通俗类比：邮局分区

假设一个国家有很多邮局（数据库向量），每个邮局负责周围一片区域。Voronoi单元就像每个邮局的「管辖区域」，区域内的所有居民点（查询点）到该邮局的距离，都比到其它邮局更近。

当你要寄信时，不需要联系全国所有邮局，只需联系你所在区域的邮局和相邻区域的邮局，就能找到最近的邮局。这就是Voronoi单元减少搜索范围的原理。

## 实际应用

在向量数据库中，Voronoi单元的原理被用于**倒排索引（IVF, Inverted File Index）**：
1. 训练阶段：用聚类算法（如K-means）将数据库向量划分为多个Voronoi单元
2. 查询阶段：
  - 找到查询点所属的单元（最近的中心点）
  - 在该单元及其邻近单元中遍历所有向量，计算距离并返回最近邻

## 常见疑问

Q1：如果查询点恰好在两个Voronoi单元的边界上，会发生什么？

A1：此时需要同时搜索这两个单元（邻近单元的定义已包含这种情况）

Q2：如何确定邻近单元？

A2：在实现中，通常通过预计算中心点之间的距离，定义一定半径内的单元为邻近

Q3：Voronoi单元划分是否完美？

A3：不是。如果聚类质量差（如数据分布不均匀），搜索效能可能下降。因此实际中会结合其他优化方法（如HNSW、量化）
